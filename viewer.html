<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <link href="output.css" rel="stylesheet">
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen p-4 print:p-0">

    <div id="upload-view" class="flex flex-col items-center justify-center min-h-[80vh] transition-opacity duration-300">
        <div class="bg-white p-10 rounded-2xl shadow-xl text-center max-w-lg w-full border-2 border-dashed border-slate-300 hover:border-blue-400 transition-colors" id="drop-zone">
            <div class="mb-6 text-6xl">üìÇ</div>
            <h1 class="text-3xl font-bold text-slate-800 mb-2">Open Notes</h1>
            <p class="text-slate-500 mb-8">Drag & drop your <code class="bg-slate-100 px-2 py-1 rounded">.json</code> file here.</p>

            <input type="file" id="file-input" accept=".json" class="hidden">
            <button id="browse-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105">
                Choose File
            </button>
            <p id="error-msg" class="mt-4 text-red-500 text-sm font-medium hidden"></p>
        </div>
    </div>

    <div id="viewer-view" class="hidden w-full max-w-5xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden print:shadow-none print:rounded-none">
        <div class="bg-slate-800 text-white p-4 sticky top-0 z-10 flex flex-wrap justify-between items-center shadow-md no-print">
            <div class="flex items-center gap-4">
                <button id="back-btn" class="text-slate-300 hover:text-white transition-colors flex items-center gap-1">‚Üê Upload New</button>
                <h2 id="header-title" class="font-semibold text-lg truncate max-w-xs">Topic</h2>
            </div>
            <div class="flex items-center gap-3">
                <button id="study-mode-btn" class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-colors border border-slate-600">
                    <span class="text-xl">üëÅÔ∏è</span>
                    <span id="study-btn-text">Study Mode</span>
                </button>
                <button onclick="window.print()" class="bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-colors border border-slate-600" title="Print">üñ®Ô∏è</button>
            </div>
        </div>

        <div id="content-area" class="p-8 md:p-12 space-y-8 min-h-screen">
            <div class="border-b-2 border-slate-800 pb-4 mb-8">
                <h1 id="doc-topic" class="text-3xl md:text-5xl font-bold text-slate-900 mb-2"></h1>
                <p id="doc-date" class="text-slate-500 text-sm"></p>
            </div>
            <div id="notes-grid" class="space-y-0"></div>
            <div id="summary-section" class="mt-12 pt-8 border-t-4 border-slate-200 hidden">
                <h3 class="text-xl font-bold text-slate-800 mb-4 uppercase tracking-wide">Summary</h3>
                <div id="summary-content" class="prose max-w-none bg-slate-50 p-6 rounded-lg border-l-4 border-slate-800 text-slate-700"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadView = document.getElementById('upload-view');
            const viewerView = document.getElementById('viewer-view');
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const browseBtn = document.getElementById('browse-btn');
            const errorMsg = document.getElementById('error-msg');
            const backBtn = document.getElementById('back-btn');
            const studyModeBtn = document.getElementById('study-mode-btn');
            const contentArea = document.getElementById('content-area');
            let isStudyMode = false;

            function showViewer() {
                uploadView.classList.add('hidden');
                viewerView.classList.remove('hidden');
                window.scrollTo(0, 0);
            }
            function showUpload() {
                viewerView.classList.add('hidden');
                uploadView.classList.remove('hidden');
                errorMsg.classList.add('hidden');
                fileInput.value = '';
                isStudyMode = false;
                updateStudyModeUI();
            }
            backBtn.addEventListener('click', showUpload);
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) processFile(e.target.files[0]);
            });
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(evt => {
                dropZone.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); });
            });
            ['dragenter', 'dragover'].forEach(evt => dropZone.classList.add('border-blue-500', 'bg-blue-50'));
            ['dragleave', 'drop'].forEach(evt => dropZone.classList.remove('border-blue-500', 'bg-blue-50'));
            dropZone.addEventListener('drop', (e) => {
                if (e.dataTransfer.files.length > 0) processFile(e.dataTransfer.files[0]);
            });

            function processFile(file) {
                if (!file.name.endsWith('.json')) {
                    errorMsg.textContent = "Please upload a valid .json file.";
                    errorMsg.classList.remove('hidden');
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        renderNotes(data);
                        showViewer();
                    } catch (err) {
                        errorMsg.textContent = "Error parsing JSON.";
                        errorMsg.classList.remove('hidden');
                    }
                };
                reader.readAsText(file);
            }

            function renderNotes(data) {
                const parseMd = (text) => typeof marked !== 'undefined' ? marked.parse(text || '') : text;
                document.getElementById('doc-topic').textContent = data.topic || 'Untitled';
                document.getElementById('header-title').textContent = data.topic || 'Untitled';
                document.getElementById('doc-date').textContent = data.lastModified ? new Date(data.lastModified).toLocaleDateString() : '';

                const grid = document.getElementById('notes-grid');
                grid.innerHTML = '';
                (data.pairs || []).forEach((pair, index) => {
                    const row = document.createElement('div');
                    row.className = `flex flex-col md:flex-row border-b border-slate-200 ${index === 0 ? 'border-t' : ''}`;
                    const imp = pair.isImportant ? 'bg-yellow-50' : '';
                    row.innerHTML = `
                        <div class="w-full md:w-1/3 p-4 md:p-6 border-r-0 md:border-r border-slate-200 ${imp}">
                            <div class="font-bold text-slate-700 text-lg sticky top-24">
                                ${pair.isImportant ? '‚≠ê ' : ''}${pair.cue}
                            </div>
                        </div>
                        <div class="w-full md:w-2/3 p-4 md:p-6 note-content relative ${imp}">
                            <div class="prose text-slate-600 max-w-none">${parseMd(pair.notes)}</div>
                        </div>`;

                    const noteContent = row.querySelector('.note-content');
                    noteContent.addEventListener('click', () => {
                        if (isStudyMode) noteContent.classList.toggle('revealed');
                    });
                    grid.appendChild(row);
                });

                const summarySec = document.getElementById('summary-section');
                if (data.summary) {
                    document.getElementById('summary-content').innerHTML = parseMd(data.summary);
                    summarySec.classList.remove('hidden');
                } else {
                    summarySec.classList.add('hidden');
                }
            }

            studyModeBtn.addEventListener('click', () => {
                isStudyMode = !isStudyMode;
                updateStudyModeUI();
            });

            function updateStudyModeUI() {
                const btnText = document.getElementById('study-btn-text');
                const content = document.getElementById('content-area');
                if (isStudyMode) {
                    content.classList.add('study-mode');
                    studyModeBtn.classList.replace('bg-slate-700', 'bg-green-600');
                    studyModeBtn.classList.replace('hover:bg-slate-600', 'hover:bg-green-700');
                    btnText.textContent = "Exit Study Mode";
                    document.querySelectorAll('.revealed').forEach(el => el.classList.remove('revealed'));
                } else {
                    content.classList.remove('study-mode');
                    studyModeBtn.classList.replace('bg-green-600', 'bg-slate-700');
                    studyModeBtn.classList.replace('hover:bg-green-700', 'hover:bg-slate-600');
                    btnText.textContent = "Study Mode";
                }
            }
        });
    </script>
</body>
</html>